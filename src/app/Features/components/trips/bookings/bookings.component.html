<p-toast></p-toast>
<p-confirmDialog></p-confirmDialog>

<div class="bookings-wrapper p-4">
    <!-- Header + Filters -->
    <div class="flex flex-column md:flex-row md:justify-content-between md:align-items-center mb-4 gap-3">
        <h2 class="m-0">Bookings</h2>
        <div class="flex flex-column sm:flex-row gap-2 w-full md:w-auto">
            <input pInputText [(ngModel)]="searchText" (input)="filterBookings()" placeholder="Search..."
                class="w-full sm:w-15rem" />
            <p-dropdown [options]="statuses" [(ngModel)]="selectedStatus" placeholder="Status"
                (onChange)="filterBookings()" class="w-full sm:w-12rem" />
            <p-dropdown [options]="categories" [(ngModel)]="selectedCategory" placeholder="Category"
                (onChange)="filterBookings()" class="w-full sm:w-12rem" />
        </div>
    </div>

    <!-- Table -->
    <p-table [value]="filteredBookings" [paginator]="true" [rows]="5" responsiveLayout="scroll" class="p-datatable-sm">
        <ng-template pTemplate="header">
            <tr>
                <th>User</th>
                <th>Trip</th>
                <th>Date</th>
                <th>People</th>
                <th>Total</th>
                <th>Status</th>
                <th>Payment</th>
                <th>Actions</th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-b>
            <tr>
                <td>{{ b.userID }}</td>
                <td>{{ b.tripID }}</td>
                <td>{{ b.bookingDate }}</td>
                <td>{{ b.numberOfPeople }}</td>
                <td>${{ b.totalPrice }}</td>
                <td>
                    <p-tag [value]="b.status" [severity]="
              b.status === 'Confirmed'
                ? 'success'
                : b.status === 'Pending'
                ? 'warn'
                : 'danger'
            "></p-tag>
                </td>
                <td>
                    <p-tag [value]="b.paymentStatus"
                        [severity]="b.paymentStatus === 'Paid' ? 'success' : 'warn'"></p-tag>
                </td>
                <td>
                    <div class="flex flex-wrap gap-2">
                        <button pButton icon="pi pi-eye" class="p-button-text p-button-sm"
                            (click)="viewBooking(b)"></button>
                        <button pButton icon="pi pi-check" class="p-button-text p-button-sm p-button-success"
                            (click)="confirmBooking(b)" [disabled]="b.status === 'Confirmed'"></button>
                        <button pButton icon="pi pi-pencil" class="p-button-text p-button-sm p-button-info"
                            (click)="editBooking(b._id)"></button>
                        <button pButton icon="pi pi-trash" class="p-button-text p-button-sm p-button-danger"
                            (click)="deleteBooking(b._id)"></button>
                    </div>
                </td>
            </tr>
        </ng-template>
    </p-table>

    <!-- Booking Details Dialog -->
    <p-dialog header="Booking Details" [(visible)]="showDetails" [modal]="true"
        [style]="{ width: '100%', 'max-width': '500px' }">
        <ng-container *ngIf="selectedBooking">
            <div class="p-fluid">
                <p><strong>User:</strong> {{ selectedBooking.userID }}</p>
                <p><strong>Trip:</strong> {{ selectedBooking.tripID }}</p>
                <p><strong>Date:</strong> {{ selectedBooking.bookingDate }}</p>
                <p><strong>People:</strong> {{ selectedBooking.numberOfPeople }}</p>
                <p><strong>Total:</strong> ${{ selectedBooking.totalPrice }}</p>
                <p><strong>Status:</strong> {{ selectedBooking.status }}</p>
                <p><strong>Payment:</strong> {{ selectedBooking.paymentStatus }}</p>
            </div>
        </ng-container>
    </p-dialog>
</div>